# Building TristansKortAnimator

## Requirements

### Windows

- **Qt 6.5+** with modules:
  - Qt Core
  - Qt Gui
  - Qt Quick
  - Qt Quick Controls 2
  - Qt Network
  - Qt Widgets
  - Qt Quick 3D
- **CMake 3.21+**
- **Visual Studio 2022** (or MSVC 2019+)
- **FFmpeg** (optional, for video export)
- **Inno Setup 6** (optional, for installer)

### Installing Qt

1. Download Qt Online Installer from https://www.qt.io/download
2. Select Qt 6.5+ for MSVC 2022 64-bit
3. Ensure Quick 3D module is checked

## Building

### Command Line

```bash
# Configure
cmake -B build -G "Visual Studio 17 2022" -A x64

# Build Release
cmake --build build --config Release

# Build Debug
cmake --build build --config Debug
```

### Qt Creator

1. Open `CMakeLists.txt` in Qt Creator
2. Select your Qt 6 MSVC kit
3. Configure project
4. Build (Ctrl+B)
5. Run (Ctrl+R)

### Visual Studio

1. Run CMake configure (generates .sln)
2. Open `build/TristansKortAnimator.sln`
3. Set TristansKortAnimator as startup project
4. Build and run

## Post-Build

The CMake build automatically runs `windeployqt` after building, which copies all required Qt DLLs and QML modules to the output directory.

## Creating Installer

### Prerequisites

1. Install [Inno Setup 6](https://jrsoftware.org/isinfo.php)
2. Ensure `ISCC.exe` is in PATH or installed to default location

### Building Installer

```bash
# Build Release first
cmake --build build --config Release

# Build installer
cmake --build build --target installer
```

Or manually:
1. Open `installer/setup.iss` in Inno Setup Compiler
2. Click Build → Compile
3. Output: `installer/output/TristansKortAnimator_v1.0.0_winx64_installer.exe`

### Installer Configuration

- **Version**: Edit `CMakeLists.txt` line 2: `project(TristansKortAnimator VERSION 1.0.0 ...)`
- **Paths**: Auto-generated by CMake in `installer/setupvars.iss`
- **Product info**: Edit `installer/version.iss.in`

## Troubleshooting

### Qt not found

```
Could not find a package configuration file provided by "Qt6"
```

Solution: Set `CMAKE_PREFIX_PATH` to your Qt installation:
```bash
cmake -B build -DCMAKE_PREFIX_PATH="C:/Qt/6.5.0/msvc2019_64"
```

### QML module not found

```
module "QtQuick" is not installed
```

Solution: Ensure `windeployqt` ran successfully, or run manually:
```bash
C:/Qt/6.5.0/msvc2019_64/bin/windeployqt.exe --qmldir qml build/Release/TristansKortAnimator.exe
```

### Quick3D not available

```
module "QtQuick3D" is not installed
```

Solution: Install Qt Quick 3D module via Qt Maintenance Tool.

### FFmpeg not found (video export)

Video export requires FFmpeg in PATH. Download from https://ffmpeg.org/download.html and add `bin` folder to PATH.

## Development Tips

### Hot Reload QML

Qt Creator supports QML hot reload for faster iteration:
1. Enable in Tools → Options → Qt Quick → QML Debugging
2. Changes to QML files apply without rebuild

### Debug Tile Loading

Set environment variable `QT_LOGGING_RULES="qt.network.ssl.warning=true"` to debug tile fetching issues.

### Profile Performance

Use Qt Creator's QML Profiler (Analyze → QML Profiler) to identify rendering bottlenecks.
